<!-- templates/frontend/all_news.html -->
{% extends "frontend/base.html" %}

{% block title %}All News - News Portal{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-8">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1>All News</h1>
                <div class="filter-section">
                    <select class="form-select" id="categoryFilter">
                        <option value="">All Categories</option>
                        {% for cat in categories %}
                        <option value="{{ cat }}" {% if category == cat %}selected{% endif %}>{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            {% if news_list %}
            <div class="row">
                {% for news in news_list %}
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        {% if news.image %}
                        <img src="{{ url_for('static', filename='uploads/' + news.image) }}" class="card-img-top" alt="{{ news.title }}" style="height: 200px; object-fit: cover;">
                        {% else %}
                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                            <i class="fas fa-newspaper fa-3x text-muted"></i>
                        </div>
                        {% endif %}
                        <div class="card-body">
                            <span class="badge bg-primary mb-2">{{ news.category }}</span>
                            <h5 class="card-title">{{ news.title }}</h5>
                            <p class="card-text">{{ news.content[:120] }}...</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <a href="{{ url_for('news_detail', news_id=news._id) }}" class="btn btn-primary">Read More</a>
                                <small class="text-muted">{{ news.date_created.strftime('%b %d, %Y') }}</small>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if total > per_page %}
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    {% if page > 1 %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('all_news', page=page-1, category=category) }}">Previous</a>
                    </li>
                    {% endif %}
                    
                    {% for p in range(1, (total // per_page) + 2) %}
                    <li class="page-item {% if p == page %}active{% endif %}">
                        <a class="page-link" href="{{ url_for('all_news', page=p, category=category) }}">{{ p }}</a>
                    </li>
                    {% endfor %}
                    
                    {% if page < (total // per_page) + 1 %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('all_news', page=page+1, category=category) }}">Next</a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
            {% else %}
            <div class="text-center py-5">
                <i class="fas fa-newspaper fa-4x text-muted mb-3"></i>
                <h3>No news found</h3>
                <p>There are no news articles matching your criteria.</p>
                <a href="{{ url_for('all_news') }}" class="btn btn-primary">View All News</a>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <div class="sidebar-sticky">
                <!-- Search Widget -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Search News</h5>
                        <div class="input-group">
                            <input type="text" class="form-control" id="sidebarSearch" placeholder="Search...">
                            <button class="btn btn-primary" type="button" id="sidebarSearchBtn">Go</button>
                        </div>
                    </div>
                </div>

                <!-- Categories Widget -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Categories</h5>
                        <div class="list-group">
                            <a href="{{ url_for('all_news') }}" class="list-group-item list-group-item-action {% if not category %}active{% endif %}">All Categories</a>
                            {% for cat in categories %}
                            <a href="{{ url_for('all_news', category=cat) }}" class="list-group-item list-group-item-action {% if category == cat %}active{% endif %}">{{ cat }}</a>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Popular News Widget -->
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Popular News</h5>
                        <div class="list-group list-group-flush">
                            <!-- This would be populated with actual popular news -->
                            <a href="#" class="list-group-item list-group-item-action">Most viewed news article 1</a>
                            <a href="#" class="list-group-item list-group-item-action">Most viewed news article 2</a>
                            <a href="#" class="list-group-item list-group-item-action">Most viewed news article 3</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('categoryFilter').addEventListener('change', function() {
    const category = this.value;
    window.location.href = `{{ url_for('all_news') }}?category=${category}`;
});

document.getElementById('sidebarSearchBtn').addEventListener('click', function() {
    const query = document.getElementById('sidebarSearch').value;
    if (query.trim()) {
        window.location.href = `{{ url_for('all_news') }}?q=${encodeURIComponent(query)}`;
    }
});

// Enter key support for search
document.getElementById('sidebarSearch').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        document.getElementById('sidebarSearchBtn').click();
    }
});
</script>
{% endblock %}